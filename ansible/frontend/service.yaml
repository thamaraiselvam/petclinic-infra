- hosts: frontend_service
  remote_user: root
  gather_facts: false
  vars:
    dest_root: /home/ubuntu
    nginx_serving_path: /var/www/html/petclinic
    nginx_config_path: /etc/nginx/nginx.conf
  tasks:
    - block:
        - name: Install nginx proxy server
          package:
            name:
              - nginx
            state: latest
            update_cache: true
        - name: install nodejs latest version
          shell: |
            curl -sL https://deb.nodesource.com/setup_15.x | sudo -E bash -
            sudo apt-get install -y nodejs
        - name: Install angular
          npm:
            name: "@angular/cli@latest"
            global: yes
            state: latest
          environment:
            NG_CLI_ANALYTICS: ci # disable log collector prompt
        - name: Create serving directory
          file:
            path: "{{nginx_serving_path}}"
            state: directory
            mode: "755"
        - name: Modify nginx config
          template:
            src: templates/frontend_nginx.j2
            dest: "{{nginx_config_path}}"
            mode: "644"
        - name: Start service
          systemd:
            name: nginx
            enabled: true
            state: started
      become: yes
      become_user: root
